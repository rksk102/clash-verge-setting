profile:
  store-selected: true      # ← 记住用户在 GUI 手动选的节点，重启不丢

mode: rule                  # ← 运行模式：按规则分流（rule）/全局（global）/直连（direct）
ipv6: true                  # ← 允许解析并转发 IPv6 流量；无 IPv6 时可改 false
tcp-concurrent: true        # ← 对同一目标并行尝试所有节点握手，取最快建链，降低延迟
unified-delay: true         # ← 统一不同协议节点的延迟计算方式，避免误判高延迟
allow-lan: false            # ← 禁止其他局域网设备连入 Clash；需共享时改 true
bind-address: "0.0.0.0"           # ← 监听所有本地网卡地址（0.0.0.0 同义）
max-worker: 10                    # 限制最大工作线程数（防止资源过载）
timeout: 30                       # 设置代理超时时间（单位：秒，避免卡顿）

sniffer:
  enable: true              # ← 开启流量嗅探，提取 TLS/HTTP Host 用于规则匹配
  force-dns-mapping: true   # ← 把嗅探到的域名写入 Fake-IP 映射，防泄漏
  parse-pure-ip: true       # ← 对无 SNI 的 TLS 流量也尝试解析
  override-destination: false
  sniff:
    HTTP:  { ports: [80, 8080,8081,8888], override-destination: true }  # ← 嗅探 80 及常见 http 端口
    TLS:   { ports: [443, 8443] }      # ← 嗅探 443 及 8443
    QUIC:  { ports: [443, 8443] }      # ← 嗅探 HTTP/3 QUIC

rules:
  - RULE-SET,all-adblock,REJECT
  - RULE-SET,win-spy,REJECT
  - RULE-SET,win-extra,REJECT
  - RULE-SET,reject,REJECT
  - RULE-SET,private,DIRECT
  - RULE-SET,lancidr,DIRECT
  - GEOIP,google,Proxies
  - RULE-SET,direct-list,DIRECT
  - RULE-SET,geolocation-cn,DIRECT
  - RULE-SET,all-cnip,DIRECT
  - RULE-SET,apple-cn,DIRECT
  - RULE-SET,microsoft-cn,DIRECT
  - GEOIP,CN,DIRECT
  - RULE-SET,category-ai-!cn,Proxies
  - RULE-SET,gfw,Proxies
  - RULE-SET,all-proxy,Proxies
  - MATCH,Proxies

#规则集
rule-providers:
# 拦截(reject)
  all-adblock:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/block/domain/rksk102/all-adblock.mrs"
    path: ./ruleset/all-adblock.mrs
    interval: 86400

  win-spy:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/block/domain/Loyalsoldier/win-spy.mrs"
    path: ./ruleset/win-spy.mrs
    interval: 86400

  win-extra:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/block/domain/Loyalsoldier/win-extra.mrs"
    path: ./ruleset/win-extra.mrs
    interval: 86400

  reject:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/block/domain/Loyalsoldier/reject.mrs"
    path: ./ruleset/reject.mrs
    interval: 86400

# 直连（direct）

  private:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/domain/Loyalsoldier/private.mrs"
    path: ./ruleset/private.mrs
    interval: 86400

  lancidr:
    type: http
    format: mrs
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/ipcidr/Loyalsoldier/lancidr.mrs"
    path: ./ruleset/lancidr.mrs
    interval: 86400

  direct-list:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/domain/Loyalsoldier/direct-list.mrs"
    path: ./ruleset/direct-list.mrs
    interval: 86400

  geolocation-cn:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/domain/MetaCubeX/geolocation-cn.mrs"
    path: ./ruleset/geolocation-cn.mrs
    interval: 86400

  all-cnip:
    type: http
    format: mrs
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/ipcidr/rksk102/all-cnip.mrs"
    path: ./ruleset/all-cnip.mrs
    interval: 86400

  apple-cn:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/domain/Loyalsoldier/apple-cn.mrs"
    path: ./ruleset/apple-cn.mrs
    interval: 86400
  
  microsoft-cn:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/direct/domain/github.com/microsoft-cn.mrs"
    path: ./ruleset/microsoft-cn.mrs
    interval: 86400

# 代理规则(proxies)
  all-proxy:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/proxy/domain/rksk102/all-proxy.mrs"
    path: ./ruleset/all-proxy.mrs
    interval: 86400

  gfw:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/proxy/domain/Loyalsoldier/gfw.mrs"
    path: ./ruleset/gfw.mrs
    interval: 86400

  category-ai-!cn:
    type: http
    format: mrs
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/rksk102/mihomo-mrs-rules@main/mrs-rules/proxy/domain/gh-proxy.com/category-ai-!cn.mrs"
    path: ./ruleset/category-ai-!cn.mrs
    interval: 86400

  # 兜底策略规则
  #  tld-not-cn:
